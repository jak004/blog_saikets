{% extends "base.html" %}
{% block title %}Posts â€¢ Porres Blogging Site{% endblock %}
{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-3">
  <div>
    <h1 class="h4 mb-1">All Posts</h1>
    <div class="text-muted small">Search and filter by category/tag.</div>
  </div>
  <form class="d-flex gap-2" method="get">
    <input type="hidden" name="q" value="{{ q }}">
    <select class="form-select form-select-sm" name="category" onchange="this.form.submit()">
      <option value="">Category</option>
      {% for c in categories %}
        <option value="{{ c.slug }}" {% if cat == c.slug %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
    <select class="form-select form-select-sm" name="tag" onchange="this.form.submit()">
      <option value="">Tag</option>
      {% for t in tags %}
        <option value="{{ t.slug }}" {% if tag == t.slug %}selected{% endif %}>{{ t.name }}</option>
      {% endfor %}
    </select>
    {% if cat or tag or q %}
      <a class="btn btn-sm btn-outline-secondary" href="{% url 'posts' %}">Reset</a>
    {% endif %}
  </form>
</div>

<div class="row g-3">
  {% for p in posts %}
    <div class="col-md-6 col-lg-4">
      <div class="card card-cool h-100 shadow-sm">
        {% if p.cover_image %}<img src="{{ p.cover_image.url }}" class="card-img-top" alt="{{ p.title }}">{% endif %}
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            {% if p.category %}<span class="badge badge-soft">{{ p.category.name }}</span>{% endif %}
            <span class="text-muted small">{{ p.published_at|date:"M d, Y" }}</span>
          </div>
          <h3 class="h6"><a class="stretched-link text-decoration-none" href="{% url 'post_detail' p.slug %}">{{ p.title }}</a></h3>
          <p class="text-muted small mb-0">{{ p.excerpt|truncatechars:140 }}</p>
        </div>
      </div>
    </div>
  {% empty %}
    <p class="text-muted">No posts match your search/filter.</p>
  {% endfor %}
</div>
{% endblock %}
